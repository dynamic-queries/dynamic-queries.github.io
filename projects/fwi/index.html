<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>FWI | Rahul Manavalan</title>
    <meta name="author" content="Rahul  Manavalan">
    <meta name="description" content="Full Waveform Inversion with Neural Operators.">
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://dynamic-queries.github.io/projects/fwi/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/">Rahul Manavalan</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">About</a>
              </li>
              

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">Research</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/talks/">Posters and Publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/teaching/">Teaching</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/cv/">CV</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      <!-- page.html -->
        <div class="post">

          <header class="post-header">
            <h1 class="post-title">FWI</h1>
            <p class="post-description">Full Waveform Inversion with Neural Operators.</p>
          </header>

          <article>
            <hr>

<h2 id="introduction">Introduction</h2>

<p>Full waveform inversion (FWI) is an effective technique to determine the subsurface mechanical properties of geological masses and engineering structures. It differs from other tomographic techniques in making use of the entire wavefield – the amplitude, phase and frequency, to estimate features with high resolution. Mathematically, it consists of minimizing the distance between a measured signal and an artifically simulated one.</p>

<p>Formally, let \(x \in \Omega\) be the domain of interest and let \(m_{o}(x)\) be an observable defined over \(\Omega\). Let \(A : m(x) \times x \mapsto u(x)\) be an operator, mapping the observable and the domain to the wavefield \(u\). (\(A\) is also known as the forward map.) If \(u_{o}(x)\) is the wavefield corresponding to \(m_{o}(x)\), then FWI is principally a minimization problem defined as:</p>

<p>\(\begin{equation}
    \label{eq:fwi}
    \arg \min_{m \in \mathcal{M}} ||u_{o}(x) - A(m(x),x)||_p
\end{equation}\)
where \(\mathcal{M}\) is the hypothesis space of candidate observables explored with respect to a suitable \(p\) norm.</p>

<p>Since its first formulation in 1977, much has been discovered about FWI with respect to the efficacy of optimizers (SGD vs quasi-Newton vs Newton vs Truncated Newton) and the choice of measures (\(L_p\) norm vs Wasserstein measure). Furthermore, advances in computing has also benefitted this discipline; with highly parallel solvers that operate on very large time and length scales.</p>

<p>Recently, machine learning based surrogates for forward maps are gaining traction due to their computational efficacy. Surrogates based on Neural Operators in particular have recently shown much promise for several applications in literature. In this work, we demostrate waveform inversion with such surrogates.</p>

<hr>
<h2 id="problem-setup">Problem Setup</h2>
<p>Let \(\Omega \subset \mathbb{R}^{d \times d}\), where \(d\) is the grid resolution.</p>

<p>For a reference observable (velocity) \(m_0:\Omega \mapsto \mathbb{R}^{d \times d}\), let the waveform be \(u_0(x,t) = A(m_0(x),x) \:\: \forall x \in \Omega\).</p>

<p>Assuming that from an initial measurement (oracle), \(u_0(x_s,t) \:\: \forall x_s \subset \Omega\), is given, we are interested in numerically estimating \(m_0(x)\).</p>

<hr>
<p>For instance, one could imagine the reference velocity \(m_0(x)\) as being :</p>
<figure>

  <picture>
    

    <!-- Fallback to the original file -->
    <img src="/assets/FWI/blog_1.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

<figure>

  <picture>
    

    <!-- Fallback to the original file -->
    <img src="/assets/FWI/blog_2.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

<p>and the corresponding waveform sampled at seven different locations (sensors) in \(\Omega\) as</p>
<figure>

  <picture>
    

    <!-- Fallback to the original file -->
    <img src="/assets/FWI/blog_3.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

<hr>

<p>The optimization problem in \((\ref{eq:fwi})\) minimizes the distance betweem the above waveform (say) \(u_{m_0}\) and a waveform \(u\) obtained from a guessed observable \(m(x)\). Applications such as this, which repeatedly invoke an expensive computational routine such as the waveform map \(A\), are referred to as outerloop applications.</p>

<p>Depending upon the choice of basis used in discretization, computational routines involving \(A\) can be very expensive, usually due to the curse of dimensionality. Alternatively, we use Neural Operator surrogates for approximating \(A\).</p>

<hr>
<h2 id="neural-operators">Neural Operators</h2>
<p>Let \(L u(x,t) = f(x,t)\) be an abstract partial differential equation for \(u \in \mathcal{U}\) and \(f \in \mathcal{F}\) (the output and input Banach spaces respectively). The operator \(L\) is said to be linear, if \(\forall f_1,f_2 \in \mathcal{F}\) and \(a,b \in \mathbb{R}\), \(L\:(a f_1 + b f_2) = a L f_1 + b L f_2\). It is known that for linear operators, there exists a propagator \(\mathcal{P}\) such that for any \(f \in \mathcal{F}\),</p>

\[\begin{equation}
    \label{eq:green}
    u(x,t) = \int dt' \int dy \: \mathcal{P}(x,y,t,t')\:f(y,t')
\end{equation}\]

<p>Neural Operators approximate \(\mathcal{P}\) by parameterizing it using a Neural Network. Hence, if one has a sufficiently many input-output pairs \(\mathcal{D} = (f_i,u_i)\), then learning the propagator \(\mathcal{P}\) is equivalent to learning the action of the operator \(L\) on all \(f \in \mathcal{F}\). We shall use this trick to approximate the waveform map \(A\).</p>

<p>Additionally, evaluating (\ref{eq:green}) is much more efficient on the Fourier space. To wit,</p>

\[\begin{equation}
    \label{eq:FT}
    \mathcal{F}_x u(x,t) = \mathcal{F}_x \left(\int dt' \int dy \: \mathcal{P}(x,y,t,t')\:f(y,t') \right)
\end{equation}\]

\[\begin{equation}
    \label{eq:FIT}
    \mathcal{F}_x u(x,t) = \mathcal{F}_x(\mathcal{P}(y,t')) \mathcal{F}_x(f(y,t'))
\end{equation}\]

<p>Approximating \(\mathcal{F}_x(\mathcal{P}(x,y,t,t'))\) using neural networks result in a computational framework that is known as Fourier Neural Operators in literature.</p>

<h2 id="approximation-with-fourier-neural-operators">Approximation with Fourier Neural Operators</h2>
<p>Fourier Neural Operators were trained on datasets generated from a full order finite difference approximation to the waveform map \(A\). Here, predictions from the surrogate for different velocity fields \(m(x)\) are presented.</p>

<p>The variety in \(m(x)\) is based on the primitive shapes such as splines, rectangles, circles and so forth. It is to be noted that, not all primitive shapes were used in training. Nevertheless, the FNO trained on a family of splines – sampled from a Gaussian process is capable of generalizing to sufficiently different function classes, as exemplified by its approximation over several seemingly disparate \(m\).</p>

<p>The evolution of the wavefield over a two dimensional domain, initially approximated by a finite difference approximation (simulation) and the FNO (surrogate) is juxtaposed for your perusal. Furthermore, the wavefield sampled at specific sensor locations (here the left end of the domain, as illustrated previously) is also presented.</p>

<style>
    .column {
  float: left;
  width: 50.00%;
  margin : 0 0 0px 0px;
  padding: 2px;
}

/* Clear floats after image containers */
.row::after {
  content: "";
  clear: both;
  display: table;
}
</style>

<p><strong><em>Spline shaped velocity fields</em></strong></p>

<p>Spline 1 <span style="color:red">[Not included in training]</span>.</p>
<div class="row">
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/normal_spline/simulation.gif" alt="spline-sim">
  </div>
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/normal_spline/surrogate.gif" alt="spline-sur">
  </div>
</div>

<p><img style="width:120%" src="/assets/FWI/validate/normal_spline/time_series.svg" alt="spline-sur"></p>

<p>Spline 2 <span style="color:red">[Not included in training]</span>.</p>
<div class="row">
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/my_spline/simulation.gif" alt="spline-sim">
  </div>
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/my_spline/surrogate.gif" alt="spline-sur">
  </div>
</div>
<p><img style="width:120%" src="/assets/FWI/validate/my_spline/time_series.svg" alt="spline-sur"></p>

<p><strong><em>Circular velocity fields</em></strong></p>

<p><span style="color:red">[Not included in training]</span>.</p>
<div class="row">
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/circle/simulation.gif" alt="spline-sim">
  </div>
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/circle/surrogate.gif" alt="spline-sur">
  </div>
</div>
<p><img style="width:120%" src="/assets/FWI/validate/circle/time_series.svg" alt="spline-sur"></p>

<p><strong><em>Rectangular velocity fields</em></strong></p>

<p><span style="color:red">[Not included in training]</span>.</p>
<div class="row">
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/rectangle/simulation.gif" alt="spline-sim">
  </div>
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/rectangle/surrogate.gif" alt="spline-sur">
  </div>
</div>
<p><img style="width:120%" src="/assets/FWI/validate/rectangle/time_series.svg" alt="spline-sur"></p>

<p><strong><em>Square velocity fields</em></strong></p>

<p><span style="color:red">[Not included in training]</span>.</p>
<div class="row">
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/square/simulation.gif" alt="spline-sim">
  </div>
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/square/surrogate.gif" alt="spline-sur">
  </div>
</div>
<p><img style="width:120%" src="/assets/FWI/validate/square/time_series.svg" alt="spline-sur"></p>

<p><strong><em>Diagonal velocity fields</em></strong></p>

<p><span style="color:red">[Not included in training]</span>.]</p>
<div class="row">
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/diagonal/simulation.gif" alt="spline-sim">
  </div>
  <div class="column">
    <img style="width:100%" src="/assets/FWI/validate/diagonal/surrogate.gif" alt="spline-sur">
  </div>
</div>
<p><img style="width:120%" src="/assets/FWI/validate/diagonal/time_series.svg" alt="spline-sur"></p>

<h2 id="inversion">Inversion</h2>

<p>The results in the previous section indicate that the surrogates albeit with some bias, can qualitatively reproduce the action of a linear waveform map \(A\). One issue that is immediately obvious from the visualizations is the wavy nature of the predictions from the FNO. This is to be expected. As truncating the higher modes from the Fourier series of a function, is known to suffer from this problem. Alternatively, a Chebyshev expansion of the function can be used, but this remains outside the scope of this work.</p>

<p>Subsequently, we use this surrogate to invert artifically generated measurements (from the simulation), say \(\tau_{m_{ref}}\), inturn resulting in velocity field \(m_{ref}(x)\). In order to ensure, the waviness of the prediction from the surrogate, does not further ill-condition the problem, the prediction is smoothed using radial bases functions.</p>

<h3 id="parameterization">Parameterization</h3>
<p>Prior to pursuing this, I will make a brief remark on how \(m(x)\) is to be parameterized.</p>

<p>Parameterization is a necessary here, as a dense mapping \(m:\Omega \mapsto \mathbb{R}\) suffers from the curse of dimensionality during gradient computation. Instead, radial bases sets are used to generate a one dimensional candidate function which is in-turn plotted inside \(\Omega\) yielding \(m_{can}\). The similarity measure between \(\tau_{m_{ref}}\) and \(\tau_{m_{can}}\) is now optimized with respect to the coefficients of these radial bases functions, say \(k\).</p>

<p>Let \(n\) be the number of radial bases functions. Then \(k \in \mathbb{R}^n\). Here, the velocity field is defined as follows:</p>

\[\begin{equation}
  m(x;k) = \eta \left(\sum_i^n k_i \phi_i(r,r_i)\right)
\end{equation}\]

\[\begin{equation}
  \eta : \mathbb{R}^n \mapsto \mathbb{R}^{d \times d}
\end{equation}\]

\[\begin{equation}
  \eta(z(r)) = \mathcal{G}  \circ \textrm{Plotting} \circ \textrm{Linear Interpolation}(r,z(r))
\end{equation}\]

          </article>

        </div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2024 Rahul  Manavalan. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script defer src="/assets/js/common.js"></script>
  <script defer src="/assets/js/copy_code.js" type="text/javascript"></script>

    
  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
  <script async src="https://badge.dimensions.ai/badge.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>
</html>
